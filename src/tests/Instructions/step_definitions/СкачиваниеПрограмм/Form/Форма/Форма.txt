&НаКлиенте
Перем СчетчикТаймера,МаксСчетчиктаймера;

//начало текста модуля
&НаКлиенте
Перем юТест;

&НаКлиенте
Функция ДобавитьШагВМассивТестов(МассивТестов,Снипет,ИмяПроцедуры,ПредставлениеТеста = Неопределено,Транзакция = Неопределено,Параметр = Неопределено)
	Структура = Новый Структура;
	Структура.Вставить("Снипет",Снипет);
	Структура.Вставить("ИмяПроцедуры",ИмяПроцедуры);
	Структура.Вставить("ИмяПроцедуры",ИмяПроцедуры);
	Структура.Вставить("ПредставлениеТеста",ПредставлениеТеста);
	Структура.Вставить("Транзакция",Транзакция);
	Структура.Вставить("Параметр",Параметр);
	МассивТестов.Добавить(Структура);
КонецФункции

&НаКлиенте
Функция ПолучитьСписокТестов(КонтекстФреймворкаBDD) Экспорт
	юТест = КонтекстФреймворкаBDD;
	
	ВсеТесты = Новый Массив;

	//описание параметров
	//ДобавитьШагВМассивТестов(ВсеТесты,Снипет,ИмяПроцедуры,ПредставлениеТеста,Транзакция,Параметр);

	ДобавитьШагВМассивТестов(ВсеТесты,"ЯОткрылВБраузереСайт(Парам01Строка)","ЯОткрылВБраузереСайт","Я открыл в браузере сайт ""https://www.sourcetreeapp.com/""");
	ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажалНаКнопкуDownloadНаСайтеSourcetree()","ЯНажалНаКнопкуDownloadНаСайтеSourcetree","Я нажал на кнопку Download на сайте sourcetree");
	ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажалНаКнопкуDownloadНаСайтеGit()","ЯНажалНаКнопкуDownloadНаСайтеGit","Я нажал на кнопку Download на сайте git");
	ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажимаюНаКнопкуDownloadPython3x()","ЯНажимаюНаКнопкуDownloadPython3x","Я нажимаю на кнопку Download Python 3x");
	ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажимаюНаКнопкуСохранить()","ЯНажимаюНаКнопкуСохранить","Я нажимаю на кнопку Сохранить");

	Возврат ВсеТесты;
КонецФункции

&НаКлиенте
Процедура ПередНачаломСценария() Экспорт
	
КонецПроцедуры

&НаКлиенте
Процедура ПередОкончаниемСценария() Экспорт
	
КонецПроцедуры

&НаКлиенте
Процедура ТаймерОжидания()
	ОтключитьОбработчикОжидания("ТаймерОжидания");
	юТест.ПродолжитьВыполнениеШагов();
КонецПроцедуры

&НаКлиенте
Процедура ТаймерОжиданияSource()
	СчетчикТаймера = СчетчикТаймера + 1;
	Если СчетчикТаймера >= МаксСчетчиктаймера Тогда
		ОтключитьОбработчикОжидания("ТаймерОжиданияSource");
		юТест.ПродолжитьВыполнениеШагов();
	КонецЕсли;	 
КонецПроцедуры

&НаКлиенте
//Я открыл в браузере сайт "https://www.sourcetreeapp.com/"
//@ЯОткрылВБраузереСайт(Парам01Строка)
Процедура ЯОткрылВБраузереСайт(АдресСайта) Экспорт
	//ВыполнитьКомандуОС(АдресСайта);
	ЗапуститьПриложение(АдресСайта);
	
	юТест.ЗапретитьВыполнениеШагов();
	Если Найти(АдресСайта,"source") > 0 Тогда
		СчетчикТаймера = 0;
		МаксСчетчиктаймера = 10;
		ПодключитьОбработчикОжидания("ТаймерОжиданияSource",1);
	Иначе	
		ПодключитьОбработчикОжидания("ТаймерОжидания",5);
	КонецЕсли;	 
КонецПроцедуры

&НаКлиенте
Функция ВыполнитьКомандуОС(Стр)

	ИмяВременногоBAT = ПолучитьИмяВременногоФайла("bat");
	
	//ЗТ = Новый ЗаписьТекста(ИмяВременногоBAT,"UTF-8",,Истина); 
	ЗТ = Новый ЗаписьТекста(ИмяВременногоBAT,КодировкаТекста.ANSI,,Истина); 
	//ЗТ.ЗаписатьСтроку("set JAVA_EXE=""C:\Program Files (x86)\Java\jre6\bin\java.exe"""); 
	ЗТ.ЗаписатьСтроку(Стр); 
	ЗТ.Закрыть();
	
	WshShell = Новый COMОбъект("WScript.Shell");
	//Сообщить(Стр);
	Рез = WshShell.Run(ИмяВременногоBAT,0,-1);
	WshShell = Неопределено;
	Возврат Рез;
	//Сообщить("Рез=" + Рез);
	//Сообщить(ИмяВременногоBAT);
	//УдалитьФайлы(ИмяВременногоBAT);
КонецФункции

&НаКлиенте
Функция ПолучитьСтрокуВызоваSikuli()
	Возврат """C:\Program Files (x86)\Java\jre6\bin\java.exe"" -Xms64M -Xmx512M -Dfile.encoding=UTF-8 -Dpython.path=""C:\Program Files (x86)\Sikuli X\sikuli-script.jar/"" -jar ""C:\Program Files (x86)\Sikuli X\sikuli-ide.jar"" -r ";
КонецФункции	

&НаКлиенте
//Я нажал на кнопку Download на сайте sourcetree
//@ЯНажалНаКнопкуDownloadНаСайтеSourcetree()
Процедура ЯНажалНаКнопкуDownloadНаСайтеSourcetree() Экспорт
	Команда = ПолучитьСтрокуВызоваSikuli() + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\SourceTree.sikuli";
	Рез = ВыполнитьКомандуОС(Команда);
	юТест.ПроверитьРавенство(Рез,0,"Был клик на кнопку большую синюю кнопку ""Скачать"".");
	//КомандаСистемы(Команда + " > h:\temp\111.txt");
КонецПроцедуры

&НаКлиенте
//Я нажал на кнопку Download на сайте git
//@ЯНажалНаКнопкуDownloadНаСайтеGit()
Процедура ЯНажалНаКнопкуDownloadНаСайтеGit() Экспорт
	//Команда = """C:\Program Files (x86)\Java\jre6\bin\java.exe"" -Xms64M -Xmx512M -Dfile.encoding=UTF-8 -Dpython.path=""C:\Program Files (x86)\Sikuli X\sikuli-script.jar/"" -jar ""C:\Program Files (x86)\Sikuli X\sikuli-ide.jar"" -r " + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\Git.sikuli";
	Команда = ПолучитьСтрокуВызоваSikuli() + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\Git.sikuli";
	Рез = ВыполнитьКомандуОС(Команда);
	юТест.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Скачать"".");
КонецПроцедуры

&НаКлиенте
//Я нажимаю на кнопку Сохранить
//@ЯНажимаюНаКнопкуСохранить()
Процедура ЯНажимаюНаКнопкуСохранить() Экспорт
	//Команда = """C:\Program Files (x86)\Java\jre6\bin\java.exe"" -Xms64M -Xmx512M -Dfile.encoding=UTF-8 -Dpython.path=""C:\Program Files (x86)\Sikuli X\sikuli-script.jar/"" -jar ""C:\Program Files (x86)\Sikuli X\sikuli-ide.jar"" -r " + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\ClickSaveFF.sikuli";
	Команда = ПолучитьСтрокуВызоваSikuli() + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\ClickSaveFF.sikuli";
	Рез = ВыполнитьКомандуОС(Команда);
	юТест.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Сохранить"" firefox.");
КонецПроцедуры


&НаКлиенте
//Я нажимаю на кнопку Download Python 3x
//@ЯНажимаюНаКнопкуDownloadPython3x()
Процедура ЯНажимаюНаКнопкуDownloadPython3x() Экспорт
	//Команда = """C:\Program Files (x86)\Java\jre6\bin\java.exe"" -Xms64M -Xmx512M -Dfile.encoding=UTF-8 -Dpython.path=""C:\Program Files (x86)\Sikuli X\sikuli-script.jar/"" -jar ""C:\Program Files (x86)\Sikuli X\sikuli-ide.jar"" -r " + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\Python.sikuli";
	Команда = ПолучитьСтрокуВызоваSikuli() + юТест.Объект.КаталогИнструментов + "\tests\AutoClick\Sikuli\Python.sikuli";
	Рез = ВыполнитьКомандуОС(Команда);
	юТест.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Скачать"".");
КонецПроцедуры

//окончание текста модуля