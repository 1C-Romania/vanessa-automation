
Функция ДобавитьНулей(ЗначениеЧисло,КолНулей)
	Стр = СтрЗаменить(Строка(ЗначениеЧисло),Символы.НПП,"");
	
	Пока СтрДлина(Стр) < КолНулей Цикл
		Стр = "0" + Стр;
	КонецЦикла;
	
	Возврат Стр;
КонецФункции	

&НаКлиенте
Функция ПолучитьИмяФайлаВидео(ПараметрыВидео)
	Стр = "scen_" + ДобавитьНулей(ПараметрыВидео.ТекИД_СценарияВМассиве,3) + "_step_" + ДобавитьНулей(ПараметрыВидео.ТекИД_ШагаВМассиве,3) + ".mp4";
	
	Возврат Стр;
КонецФункции	

&НаКлиенте
Процедура Инициализация(ПараметрыВидео) Экспорт
	ИмяФайла = ПараметрыВидео.ЗаписьВидеоКаталогДляВременныхФайлов;
	ФайлПроверкаСуществования = Новый Файл(ИмяФайла);
	Если НЕ ФайлПроверкаСуществования.Существует() Тогда
		Сообщить("Каталог ЗаписьВидеоКаталогДляВременныхФайлов <" + ИмяФайла + "> не существует!");
		ВызватьИсключение "Каталог ЗаписьВидеоКаталогДляВременныхФайлов <" + ИмяФайла + "> не существует!";
		Возврат;
	КонецЕсли;	 
КонецПроцедуры

&НаКлиенте
Процедура НачатьЗаписьВидеоОдногоШага(ПараметрыВидео) Экспорт
	КомандаНачатьЗаписьВидео = ПараметрыВидео.ЗаписьВидеоКомандаНачатьЗаписьВидео;
	
	Если ПараметрыВидео.ЗаписьВидеоПоказыватьКурсорМыши Тогда
		КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,"<screenmouseimage>",ПараметрыВидео.ЗаписьВидеоФайлКурсораМышки);
	Иначе
		КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,":screen-mouse-image=""<screenmouseimage>""","");
	КонецЕсли;	 
	
	
	КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,"<screenwidth>",ПараметрыВидео.ЗаписьВидеоЭкранШирина);
	КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,"<screenheight>",ПараметрыВидео.ЗаписьВидеоЭкранВысота);
	
	
	
	ИмяФайлаВидео            = ПараметрыВидео.ЗаписьВидеоКаталогДляВременныхФайлов  + "\" + ПолучитьИмяФайлаВидео(ПараметрыВидео);
	КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,"<dst>",ИмяФайлаВидео);
	
	
	КомандаНачатьЗаписьВидео = СтрЗаменить(КомандаНачатьЗаписьВидео,Символы.НПП,"");
	
	ПараметрыВидео.Ванесса.Отладка(КомандаНачатьЗаписьВидео);
	
	
	ПараметрыВидео.Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна(КомандаНачатьЗаписьВидео,0);
	
	
	//ждём чтобы файл появился на диске
	СчетчикПроверок     = 0;
	МаксСчетчикПроверок = 10;
	Пока Истина Цикл
		СчетчикПроверок = СчетчикПроверок + 1;
		
		Если СчетчикПроверок > МаксСчетчикПроверок Тогда
			ВызватьИсключение "Не найден файл <" + ИмяФайлаВидео + ">";
		КонецЕсли;	 
		
		ФайлПроверкаСуществования = Новый Файл(ИмяФайлаВидео);
		Если НЕ ФайлПроверкаСуществования.Существует() Тогда
			ПараметрыВидео.Ванесса.Sleep(1);
			Продолжить;
		Иначе
			Прервать;
		КонецЕсли;	 
		
		
	КонецЦикла;
	
	
КонецПроцедуры

Процедура ОстановитьЗаписьВидео(ПараметрыВидео) Экспорт
КонецПроцедуры